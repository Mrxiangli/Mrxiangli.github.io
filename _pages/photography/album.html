<script>
  console.log("Script initializing...");

  // 1. Get folder from URL parameter
  const urlParams = new URLSearchParams(window.location.search);
  const targetFolder = urlParams.get('folder');
  console.log("Target Folder:", targetFolder);

  // 2. Set a generic title (We will fix the fancy title later)
  document.getElementById('album-title').innerText = "Album: " + (targetFolder || "Unknown");

  // 3. Fetch images 
  // We use the root-relative path to be safe. 
  // This assumes your repo is named 'mrxiangli.github.io'.
  // If your repo has a different name, add it: '/my-repo/assets/photos.json'
  const fetchUrl = '/assets/photos.json?v=' + new Date().getTime();
  
  console.log("Attempting fetch from:", fetchUrl);

  fetch(fetchUrl)
    .then(response => {
      console.log("Fetch Status:", response.status);
      if (!response.ok) {
        throw new Error("HTTP " + response.status + " - File not found");
      }
      return response.json();
    })
    .then(data => {
      console.log("Photos found in JSON:", data.length);
      const container = document.getElementById('gallery-container');
      
      const albumImages = data.filter(img => {
        if (!img.path || !targetFolder) return false;
        
        // Remove leading slashes from both paths to compare them safely
        const p1 = img.path.toLowerCase().replace(/^\//, '');
        const p2 = targetFolder.toLowerCase().replace(/^\//, '');
        
        return p1.includes(p2);
      });

      console.log("Matching images:", albumImages.length);

      if (albumImages.length === 0) {
        container.innerHTML = "<p>No photos match. Checked: " + targetFolder + "</p>";
        return;
      }

      albumImages.forEach(img => {
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo';
        
        const link = document.createElement('a');
        // Ensure path starts with /
        const correctPath = img.path.startsWith('/') ? img.path : '/' + img.path;
        link.href = correctPath; 
        
        const imgTag = document.createElement('img');
        imgTag.src = correctPath;
        imgTag.loading = "lazy";
        
        link.appendChild(imgTag);
        photoDiv.appendChild(link);
        container.appendChild(photoDiv);
      });
    })
    .catch(err => {
      console.error('Fetch Error:', err);
      document.getElementById('gallery-container').innerHTML = "<p>Error: " + err.message + "</p>";
    });
</script>