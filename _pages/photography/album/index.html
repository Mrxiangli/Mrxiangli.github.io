---
layout: default
title: Photo Album
---

<div class="album-container">
  
  <div class="album-header">
    <h1 id="album-title" class="album-title">Loading...</h1>
    <a href="/photography/" class="back-btn">‚Üê Back to Map</a>
  </div>

  <div id="gallery-container" class="photo-gallery">
    </div>

</div>

<script>
  console.log("Script initializing...");

  // 1. Get folder from URL parameter
  const urlParams = new URLSearchParams(window.location.search);
  const targetFolder = urlParams.get('folder');
  console.log("Target Folder:", targetFolder);

  // --- SAFE LOADING START ---
  // If site.data.map_locations is missing, this defaults to null.
  // We use '|| []' to ensure it's always an array, preventing the crash.
  const rawData = {{ site.data.map_locations | jsonify }};
  const mapLocations = rawData || [];
  console.log("Map Locations Loaded:", mapLocations.length);
  // --- SAFE LOADING END ---

  // 2. Set the Title (Wrapped in Try/Catch so it never kills the script)
  try {
    let pageTitle = "Untitled Album";

    if (targetFolder) {
      const cleanTarget = targetFolder.replace(/^\//, '');
      
      // Safety check: ensure mapLocations has data before searching
      if (mapLocations.length > 0) {
        const match = mapLocations.find(loc => {
            return loc.link && loc.link.replace(/^\//, '').includes(cleanTarget);
        });
        if (match) pageTitle = match.title;
      }
      
      // Fallback if no match found
      if (pageTitle === "Untitled Album") {
        const parts = cleanTarget.split('/');
        const folderName = parts[parts.length - 1] || parts[parts.length - 2]; 
        if (folderName) {
           pageTitle = folderName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
      }
    }
    
    document.getElementById('album-title').innerText = pageTitle;
    document.title = pageTitle + " - Photography";
    
  } catch (err) {
    console.error("Non-fatal error setting title:", err);
  }

  // 3. Fetch images (Using Relative Path)
  // We use '../' to traverse up from /photography/album/ to root, then to assets
  const fetchUrl = '../../assets/photos.json?v=' + new Date().getTime();
  console.log("Attempting fetch from:", fetchUrl);

  fetch(fetchUrl)
    .then(response => {
      console.log("Fetch response status:", response.status);
      if (!response.ok) throw new Error("HTTP " + response.status + " - File not found");
      return response.json();
    })
    .then(data => {
      console.log("Photos JSON loaded. Items:", data.length);
      const container = document.getElementById('gallery-container');
      
      const albumImages = data.filter(img => {
        if (!img.path || !targetFolder) return false;
        
        // Robust comparison: remove leading slashes and lowercase both
        const p1 = img.path.toLowerCase().replace(/^\//, '');
        const p2 = targetFolder.toLowerCase().replace(/^\//, '');
        
        return p1.includes(p2);
      });

      console.log("Filtered images count:", albumImages.length);

      if (albumImages.length === 0) {
        container.innerHTML = "<p>No photos found. (Checked path: " + targetFolder + ")</p>";
        return;
      }

      albumImages.forEach(img => {
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo';
        
        const link = document.createElement('a');
        // Fix path prefix if needed
        const correctPath = img.path.startsWith('/') ? img.path : '/' + img.path;
        link.href = correctPath; 
        
        const imgTag = document.createElement('img');
        imgTag.src = correctPath;
        imgTag.loading = "lazy";
        
        link.appendChild(imgTag);
        photoDiv.appendChild(link);
        container.appendChild(photoDiv);
      });
    })
    .catch(err => {
      console.error('CRITICAL FETCH ERROR:', err);
      document.getElementById('gallery-container').innerHTML = "<p>Error loading gallery: " + err.message + "</p>";
    });
</script>